@model ADYC.WebUI.ViewModels.OfferingListViewModel

@{
    ViewBag.Title = "Offerings";
}

<h2>Offerings</h2>

<div id="msg-div">
</div>

<div class="row">
    <div class="col-sm-8">
        <ul class="term-info">
            <li>
                <h5><strong>Term Name: </strong>@Model.Term.Name (@Model.Term)</h5>
            </li>
            <li>
                <h5><strong>Enrollment Deadline: </strong>@Model.Term.EnrollmentDeadLine.ToString("MMMM dd, yyyy")</h5>
                <h5><strong>Enrollment Withdraw: </strong>@Model.Term.EnrollmentDropDeadLine.ToString("MMMM dd, yyyy")</h5>
            </li>
            <li>
                <h5><strong>Current Term: </strong> @(Model.Term.IsCurrentTerm ? "Yes" : "No")</h5>
            </li>
        </ul>
    </div>
</div>

<div class="btn-toolbar">
    <div class="btn-group">
        <a id="newOfferingBtn" href="@Url.Action("new")" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-plus"></i> Create Offering</a>
        <a href="@Url.Action("Index")" class="btn btn-default btn-sm"><i class="glyphicon glyphicon-circle-arrow-left"></i> Back to list of terms</a>
    </div>
</div>

@Html.HiddenFor(m => Model.Term.Id)

<table id="offerings" class="table table-bordered table-striped display">
    <thead>
        <tr>
            <th>
                Id
            </th>
            <th>
                Title
            </th>
            <th>
                Location
            </th>
            <th>
                Days Offered
            </th>
            <th>
                Professor
            </th>
            <th>
                Course
            </th>
            <th>
                Course Type
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var offering in Model.Offerings)
            {
            @Html.Partial("pv_OfferingRow", offering)
        }
    </tbody>
</table>

@section scripts
{
    <script>
        $(document).ready(function () {

            function addDeleteEvent() {
                $(".js-delete").on("click", deleteFn);
            }

            function deleteFn(e) {
                e.preventDefault();

                var link = $(this);
                var tr = link.closest("tr");

                bootbox.prompt({
                    title: link.attr("data-name"),
                    inputType: 'checkbox',
                    inputOptions: [
                        {
                            text: 'Force deleting offering?',
                            value: '1',
                        }
                    ],
                    callback: function (result) {
                        console.log(result);
                        if (result !== null) {
                            var href = link.attr("href");

                            if (result[0] === '1') {
                                href = href.replace("force=False", "force=True");
                            }

                            $.ajax({
                                url: href,
                                method: "get",
                                success: function (data) {
                                    tr.remove();
                                    addDeleteEvent();
                                },
                                error: function (data) {
                                    bootbox.alert(data.statustext);
                                }
                            });
                        }
                    }
                });
            }

            addDeleteEvent();

            $('#offerings').DataTable();

            $("#newOfferingBtn").click(function (e) {
                e.preventDefault();

                var termId = $("<input type='hidden'/>")
                    .attr("name", "TermId")
                    .val($("#Term_Id").val());

                $("<form>")
                    .attr("method", "post")
                    .attr("action", $(this).attr("href"))
                    .append(termId)
                    .appendTo(document.body)
                    .submit();
            });

            $(".js-edit").on("click", function (e) {
                e.preventDefault();

                var termId = $("<input type='hidden'/>")
                    .attr("name", "TermId")
                    .val($("#Term_Id").val());

                var offeringId = $("<input type='hidden'/>")
                    .attr("name", "OfferingId")
                    .val($(this).attr("data-offeringId"));

                $("<form>")
                    .attr("method", "post")
                    .attr("action", $(this).attr("href"))
                    .append(termId)
                    .append(offeringId)
                    .appendTo(document.body)
                    .submit();
            });

        });
    </script>

    <script type="text/javascript" src="~/Scripts/adyc.table.utils.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
}